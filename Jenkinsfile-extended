pipeline {
    agent any
    
    environment {
        PROJECT_NAME = "Temperature-Converter"
        VERSION = "1.0.0"
    }
    
    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/AymenAkhtar/Temperature-Converter.git'
                echo "ğŸ” Checked out Temperature Converter application"
            }
        }
        
        stage('Install Dependencies') {
            steps {
                bat 'npm install'
                echo "ğŸ“¦ Dependencies installed successfully"
            }
        }
        
        stage('Code Linting') {
            steps {
                bat 'npm run lint'
                echo "ğŸ” Linting completed"
            }
        }
        
        stage('Run Tests') {
            steps {
                bat 'npm test'
                echo "ğŸ§ª Tests executed successfully"
            }
        }
        
        stage('Build Application') {
            steps {
                bat 'npm run build'
                echo "ğŸ”¨ Application built successfully"
            }
        }
        
        stage('Create Deployment Artifact') {
    steps {
        script {
            // Create timestamp for artifact
            def timestamp = new Date().format('yyyyMMdd-HHmmss')
            def artifactName = "temperature-converter-${timestamp}.zip"
            
            // Create zip artifact - ALL files include karega
            bat "powershell Compress-Archive -Path * -DestinationPath ${artifactName} -Force"
            
            // Archive in Jenkins
            archiveArtifacts artifacts: "${artifactName}", fingerprint: true
            
            echo "ğŸ“¦ Artifact created: ${artifactName}"
        }
    }
}
        
        stage('Security Scan') {
            steps {
                bat 'npm audit --audit-level moderate || echo \"Security scan completed\"'
                echo "ğŸ”’ Security vulnerability check completed"
            }
        }
    }
    
    post {
        always {
            echo "=== BUILD SUMMARY ==="
            echo "Project: ${env.PROJECT_NAME}"
            echo "Build: #${env.BUILD_NUMBER}"
            echo "Status: ${currentBuild.currentResult}"
            echo "Duration: ${currentBuild.durationString}"
            echo "======================"
        }
        
        success {
            echo 'ğŸ‰ Temperature Converter - All stages completed successfully!'
            
            // Simulated email notification
            echo "ğŸ“§ EMAIL NOTIFICATION:"
            echo "ğŸ“§ To: team@example.com"
            echo "ğŸ“§ Subject: SUCCESS - Temperature Converter Build #${env.BUILD_NUMBER}"
            echo "ğŸ“§ Body: Temperature Converter application built successfully. Artifact ready for deployment."
            echo "ğŸ“§ Build URL: ${env.BUILD_URL}"
            
            // Build artifact info
            echo "ğŸ“¦ ARTIFACT: temperature-converter-*.zip created and archived"
        }
        
        failure {
            echo 'âŒ Temperature Converter - Build failed!'
            
            // Simulated email notification for failure
            echo "ğŸ“§ EMAIL NOTIFICATION:"
            echo "ğŸ“§ To: team@example.com"
            echo "ğŸ“§ Subject: FAILED - Temperature Converter Build #${env.BUILD_NUMBER}"
            echo "ğŸ“§ Body: Build failed. Please check Jenkins console immediately."
            echo "ğŸ“§ Build URL: ${env.BUILD_URL}"
        }
        
        unstable {
            echo 'âš ï¸ Temperature Converter - Build unstable!'
            echo "ğŸ“§ EMAIL: Build unstable notification sent to team@example.com"
        }
    }
}